C     Originallly Coded:  Z. Zhang
C           Modified By:  D. Gilmore ---> (24 May 95)
C     -----------------------------------------------------
C     L. ADAMOWICZ RESEARCH / UNIVERSITY OF ARIZONA / CHEM.
C     -----------------------------------------------------
      SUBROUTINE ELREP(DFLAG,OVERLAP,AX,AY,AZ,A1,BX,BY,BZ,A2,                      
     1                 CX,CY,CZ,A3,DX,DY,DZ,A4,
     2                 A5,A6,ER,KLM)                       
C     -----------------------------------------------------
C     ELREP INTGL_1 = <psi(L)@A|(???)|psi{k)@B>
C     -----------------------------------------------------
      IMPLICIT REAL*8 (A-H,O-Z)
	INTEGER DFLAG
C     -----------------------------------------------------
C     *** FOUR CENTER ELECTRON REPULSION INTEGRAL ***
C     -----------------------------------------------------
	PARAMETER(C1=0.564691197D-04)
	PARAMETER(C2=0.758433197D-03)
	PARAMETER(C3=0.769838037D-02)
	PARAMETER(C4=0.629344460D-01)
	PARAMETER(C5=0.213271302D+00)
	PARAMETER(C6=0.720266520D-04)
	PARAMETER(C7=0.955528842D-03)
	PARAMETER(C8=0.101431553D-01)
	PARAMETER(C9=0.738522953D-01)
	PARAMETER(C10=0.338450368D+00)
	PARAMETER(C11=0.879937801D+00)
	COMMON /DOVn/ DOVnDA1,DOVnDA2,DOVnDA5,DOVnDAZ,DOVnDBZ
	COMMON /DER/ DERDA1,DERDA2,DERDA5,DERDAZ,DERDBZ
      DATA ONE,TWO,FOUR,SIX,EIGHT,HALF/1.,2.,4.,6.,8.,.5/               
      PI=3.1415926535898D+00
C      PI52=PI**2.5D+00
      ALK1=A1+A2                                                       
      ALK2=A3+A4                                                       
      BLK12=A5+A6
      ALKXX=ALK2+BLK12
      DETAB=ALK1*ALK2+(ALK1+ALK2)*BLK12
C     -----------------------------------------------------
C     --- ONE CENTER ELECTRON REPULSION INTEGRAL ---
C     -----------------------------------------------------
C      ER=TWO*PI52/(DETAB*DSQRT(ALK1+ALK2))
C
	ER=TWO*OVERLAP*DSQRT(DETAB/(PI*(ALK1+ALK2)))
C
C     -----------------------------------------------------
C     --- CENTERS ---
C     -----------------------------------------------------
C      CALL KFACT(AX,AY,AZ,A1,BX,BY,BZ,A2,                      
C     1           CX,CY,CZ,A3,DX,DY,DZ,A4,
C     2           A5,A6,XK)
C	WRITE(6,*)A1,AX,A2,BX,ALK1 
      RX1=(A1*AX+A2*BX)/ALK1
      RX2=(A3*CX+A4*DX)/ALK2
      RY1=(A1*AY+A2*BY)/ALK1
      RY2=(A3*CY+A4*DY)/ALK2
      RZ1=(A1*AZ+A2*BZ)/ALK1
      RZ2=(A3*CZ+A4*DZ)/ALK2
      DD=(RX1-RX2)**2+(RY1-RY2)**2+(RZ1-RZ2)**2
C      ZZ=EXP(-(ALK1*ALK2*BLK12)*DD/DETAB)
C     -----------------------------------------------------
C     --- FOUR-CENTER ELECTRON REPULSION INTEGRAL ---
C     -----------------------------------------------------
      WW=ALK1*ALK1*ALK2*ALK2*DD/((ALK1+ALK2)*DETAB) 
C      ER=ER*XK*F0(WW) 
	ER=ER*F0(WW)
C      GOTO 1500

C
C
	IF (DFLAG .EQ. 1) THEN
C
C	DERDA1:
C	======================================================
	Z=WW
	PHIF=((((((C6*Z + C7)*Z + C8)*Z+ C9)*Z + C10)*Z + C11)*Z + 1.00D+0
	-0)
	THETAF=(((((C1*Z + C2)*Z + C3)*Z + C4)*Z+ C5)*Z +1.00D+00)

	OKL=DSQRT(DETAB)
	PKL=DSQRT(1.00D+00/(PI*(ALK1+ALK2)))
	ANKL=OKL*PKL
	AMKL=2.00D+00*OVERLAP*ANKL

	DZZ=ALK1**2.00D+00*ALK2**2.00D+00*(2.00D+00*(AX/ALK1-(A1*AX+A2*BX)
	-/ALK1**2.00D+00)*((A1*AX+A2*BX)/ALK1-(A3*CX+A4*DX)/ALK2)+2*(AY/ALK
     -1-(A1*AY+A2*BY)/ALK1**2.00D+00)*((A1*AY+A2*BY)/ALK1-(A3*CY+A4*DY)/
     -ALK2)+2.00D+00*(AZ/ALK1-(A1*AZ+A2*BZ)/ALK1**2.00D+00)*((A1*AZ+A2*B
     -Z)/ALK1-(A3*CZ+A4*DZ)/ALK2))/(DETAB*(ALK1+ALK2))-ALK1**2.00D+00*AL
     -K2**2.00D+00*(((A1*AX+A2*BX)/ALK1-(A3*CX+A4*DX)/ALK2)**2.00D+00+((
     -A1*AY+A2*BY)/ALK1-(A3*CY+A4*DY)/ALK2)**2.00D+00+((A1*AZ+A2*BZ)/ALK
     -1-(A3*CZ+A4*DZ)/ALK2)**2.00D+00)/(DETAB*(ALK1+ALK2)**2.00D+00)+2.0
     -0D+00*ALK1*ALK2**2.00D+00*(((A1*AX+A2*BX)/ALK1-(A3*CX+A4*DX)/ALK2)
     -**2.00D+00+((A1*AY+A2*BY)/ALK1-(A3*CY+A4*DY)/ALK2)**2.00D+00+((A1*
     -AZ+A2*BZ)/ALK1-(A3*CZ+A4*DZ)/ALK2)**2.00D+00)/(DETAB*(ALK1+ALK2))-
     -ALKXX*ALK1**2.00D+00*ALK2**2.00D+00*(((A1*AX+A2*BX)/ALK1-(A3*CX+A4
     -*DX)/ALK2)**2.00D+00+((A1*AY+A2*BY)/ALK1-(A3*CY+A4*DY)/ALK2)**2.00
     -D+00+((A1*AZ+A2*BZ)/ALK1-(A3*CZ+A4*DZ)/ALK2)**2.00D+00)/(DETAB**2.
     -00D+00*(ALK1+ALK2))

	DTHETAF=5.00D+00*C1*Z**4.00D+00*DZZ+4.00D+00*C2*Z**3.00D+00*DZZ+3.
	-00D+00*C3*Z**2.00D+00*DZZ+2.00D+00*C4*Z*DZZ+C5*DZZ

	DPHIF=6.00D+00*C6*Z**5.00D+00*DZZ+5.00D+00*C7*Z**4.00D+00*DZZ+4.00
	-D+00*C8*Z**3.00D+00*DZZ+3.00D+00*C9*Z**2.00D+00*DZZ+2.00D+00*C10*Z
     -*DZZ+C11*DZZ

	DF0=(DSQRT(PHIF)/(2.00D+00*DSQRT(THETAF)))*(-(THETAF/PHIF**2.00D+0
	-0)*DPHIF+(1.00D+00/PHIF)*DTHETAF)

	FF=DSQRT(THETAF/PHIF)

	DDETAB=ALKXX
	DTEMP=PI

	DOKL=(1.00D+00/(2.00D+00*DSQRT(DETAB)))*DDETAB
	DPKL=(-1.00D+00/(2.00D+00*((PI*ALK2+PI*ALK1)*DSQRT((PI*ALK2+PI*ALK
	-1)))))*DTEMP
	
      DNKL=(OKL*DPKL + PKL*DOKL)

	DMKL=2.00D+00*(OVERLAP*DNKL + ANKL*DOVnDA1)

	DERDA1=AMKL*DF0 + FF*DMKL
C
C	WRITE(6,*)'DERDA1=',DERDA1
C	WRITE(6,*)'MKL=',AMKL
C	WRITE(6,*)'DF0=',DF0
C	WRITE(6,*)'F0=',FF
C	WRITE(6,*)'DMKL=',DMKL
C	WRITE(6,*)'OVERLAP=',OVERLAP
C	WRITE(6,*)'DNKL=',DNKL
C	WRITE(6,*)'NKL=',ANKL
C	WRITE(6,*)'DSKL=',DOVnDA1
C	CALL BIOUT(' ')
C	STOP
C
C	DERDA2:
C	======================================================
	Z=WW
	PHIF=((((((C6*Z + C7)*Z + C8)*Z+ C9)*Z + C10)*Z + C11)*Z + 1.00D+0
	-0)
	THETAF=(((((C1*Z + C2)*Z + C3)*Z + C4)*Z+ C5)*Z +1.00D+00)

	OKL=DSQRT(DETAB)
	PKL=DSQRT(1.00D+00/(PI*(ALK1+ALK2)))
	ANKL=OKL*PKL
	AMKL=2.00D+00*OVERLAP*ANKL

	DZZ=ALK1**2.00D+00*ALK2**2.00D+00*(2.00D+00*(-(CX/ALK2)+(A3*CX+A4*
	-DX)/ALK2**2.00D+00)*((A1*AX+A2*BX)/ALK1-(A3*CX+A4*DX)/ALK2)+2.00D+
     -00*(-(CY/ALK2)+(A3*CY+A4*DY)/ALK2**2.00D+00)*((A1*AY+A2*BY)/ALK1-(
     -A3*CY+A4*DY)/ALK2)+2.00D+00*(-(CZ/ALK2)+(A3*CZ+A4*DZ)/ALK2**2.00D+
     -00)*((A1*AZ+A2*BZ)/ALK1-(A3*CZ+A4*DZ)/ALK2))/(DETAB*(ALK1+ALK2))-A
     -LK1**2.00D+00*ALK2**2.00D+00*(((A1*AX+A2*BX)/ALK1-(A3*CX+A4*DX)/AL
     -K2)**2.00D+00+((A1*AY+A2*BY)/ALK1-(A3*CY+A4*DY)/ALK2)**2.00D+00+((
     -A1*AZ+A2*BZ)/ALK1-(A3*CZ+A4*DZ)/ALK2)**2.00D+00)/(DETAB*(ALK1+ALK2
     -)**2.00D+00)+2.00D+00*ALK1**2.00D+00*ALK2*(((A1*AX+A2*BX)/ALK1-(A3
     -*CX+A4*DX)/ALK2)**2.00D+00+((A1*AY+A2*BY)/ALK1-(A3*CY+A4*DY)/ALK2)
     -**2.00D+00+((A1*AZ+A2*BZ)/ALK1-(A3*CZ+A4*DZ)/ALK2)**2.00D+00)/(DET
     -AB*(ALK1+ ALK2))-ALK1**2.00D+00*ALK2**2.00D+00*(ALK1+BLK12)*(((A1*
     -AX+A2*BX)/ALK1-(A3*CX+A4*DX)/ALK2)**2.00D+00+((A1*AY+A2*BY)/ALK1-(
     -A3*CY+A4*DY)/ALK2)**2.00D+00+((A1*AZ+A2*BZ)/ALK1-(A3*CZ+A4*DZ)/ALK
     -2)**2.00D+00)/(DETAB**2.00D+00*(ALK1+ALK2))

	DTHETAF=5.00D+00*C1*Z**4.00D+00*DZZ+4.00D+00*C2*Z**3.00D+00*DZZ+3.
	-00D+00*C3*Z**2.00D+00*DZZ+2.00D+00*C4*Z*DZZ+C5*DZZ

	DPHIF=6.00D+00*C6*Z**5.00D+00*DZZ+5.00D+00*C7*Z**4.00D+00*DZZ+4.00
	-D+00*C8*Z**3.00D+00*DZZ+3.00D+00*C9*Z**2.00D+00*DZZ+2.00D+00*C10*Z
     -*DZZ+C11*DZZ

	DF0=(DSQRT(PHIF)/(2.00D+00*DSQRT(THETAF)))*(-(THETAF/PHIF**2.00D+0
	-0)*DPHIF+(1.00D+00/PHIF)*DTHETAF)

	FF=DSQRT(THETAF/PHIF)

	DDETAB=ALK1+BLK12
	DTEMP=PI

	DOKL=(1.00D+00/(2.00D+00*DSQRT(DETAB)))*DDETAB
	DPKL=(-1.00D+00/(2.00D+00*((PI*ALK2+PI*ALK1)*DSQRT((PI*ALK2+PI*ALK
	-1)))))*DTEMP
	
      DNKL=(OKL*DPKL + PKL*DOKL)

	DMKL=2.00D+00*(OVERLAP*DNKL + ANKL*DOVnDA2)

	DERDA2=AMKL*DF0 + FF*DMKL
C
C	DERDA5:
C	======================================================
	Z=WW
	PHIF=((((((C6*Z + C7)*Z + C8)*Z+ C9)*Z + C10)*Z + C11)*Z + 1.00D+0
	-0)
	THETAF=(((((C1*Z + C2)*Z + C3)*Z + C4)*Z+ C5)*Z +1.00D+00)

	OKL=DSQRT(DETAB)
	PKL=DSQRT(1.00D+00/(PI*(ALK1+ALK2)))
	ANKL=OKL*PKL
	AMKL=2.00D+00*OVERLAP*ANKL

	DZZ=-(ALK1**2.00D+00*ALK2**2.00D+00*(((A1*AX+A2*BX)/ALK1-(A3*CX+A4
	-*DX)/ALK2)**2.00D+00+((A1*AY+A2*BY)/ALK1-(A3*CY+A4*DY)/ALK2)**2.00
     -D+00+((A1*AZ+A2*BZ)/ALK1-(A3*CZ+A4*DZ)/ALK2)**2.00D+00)/DETAB**2.0
     -0D+00)

	DTHETAF=5.00D+00*C1*Z**4.00D+00*DZZ+4.00D+00*C2*Z**3.00D+00*DZZ+3.
	-00D+00*C3*Z**2.00D+00*DZZ+2.00D+00*C4*Z*DZZ+C5*DZZ

	DPHIF=6.00D+00*C6*Z**5.00D+00*DZZ+5.00D+00*C7*Z**4.00D+00*DZZ+4.00
	-D+00*C8*Z**3.00D+00*DZZ+3.00D+00*C9*Z**2.00D+00*DZZ+2.00D+00*C10*Z
     -*DZZ+C11*DZZ

	DF0=(DSQRT(PHIF)/(2.00D+00*DSQRT(THETAF)))*(-(THETAF/PHIF**2.00D+0
	-0)*DPHIF+(1.00D+00/PHIF)*DTHETAF)

	FF=DSQRT(THETAF/PHIF)

	DDETAB=ALK1+ALK2
	DTEMP=0.00D+00

	DOKL=(1.00D+00/(2.00D+00*DSQRT(DETAB)))*DDETAB
	DPKL=(-1.00D+00/(2.00D+00*((PI*ALK2+PI*ALK1)*DSQRT((PI*ALK2+PI*ALK
	-1)))))*DTEMP
	
      DNKL=(OKL*DPKL + PKL*DOKL)

	DMKL=2.00D+00*(OVERLAP*DNKL + ANKL*DOVnDA5)

	DERDA5=AMKL*DF0 + FF*DMKL
C
C	DERDAZ:
C	======================================================
	Z=WW
	PHIF=((((((C6*Z + C7)*Z + C8)*Z+ C9)*Z + C10)*Z + C11)*Z + 1.00D+0
	-0)
	THETAF=(((((C1*Z + C2)*Z + C3)*Z + C4)*Z+ C5)*Z +1.00D+00)

	OKL=DSQRT(DETAB)
	PKL=DSQRT(1.00D+00/(PI*(ALK1+ALK2)))
	ANKL=OKL*PKL
	AMKL=2.00D+00*OVERLAP*ANKL

	DZZ=2.00D+00*A1*ALK1*ALK2**2.0D+00*((A1*AZ+A2*BZ)/ALK1-(A3*CZ+A4*D
	-Z)/ALK2)/(DETAB*(ALK1+ALK2))

	DTHETAF=5.00D+00*C1*Z**4.00D+00*DZZ+4.00D+00*C2*Z**3.00D+00*DZZ+3.
	-00D+00*C3*Z**2.00D+00*DZZ+2.00D+00*C4*Z*DZZ+C5*DZZ

	DPHIF=6.00D+00*C6*Z**5.00D+00*DZZ+5.00D+00*C7*Z**4.00D+00*DZZ+4.00
	-D+00*C8*Z**3.00D+00*DZZ+3.00D+00*C9*Z**2.00D+00*DZZ+2.00D+00*C10*Z
     -*DZZ+C11*DZZ

	DF0=(DSQRT(PHIF)/(2.00D+00*DSQRT(THETAF)))*(-(THETAF/PHIF**2.00D+0
	-0)*DPHIF+(1.00D+00/PHIF)*DTHETAF)

	FF=DSQRT(THETAF/PHIF)

	DDETAB=0.00D+00
	DTEMP=0.00D+00

	DOKL=(1.00D+00/(2.00D+00*DSQRT(DETAB)))*DDETAB
	DPKL=(-1.00D+00/(2.00D+00*((PI*ALK2+PI*ALK1)*DSQRT((PI*ALK2+PI*ALK
	-1)))))*DTEMP
	
      DNKL=(OKL*DPKL + PKL*DOKL)

	DMKL=2.00D+00*(OVERLAP*DNKL + ANKL*DOVnDAZ)

	DERDAZ=AMKL*DF0 + FF*DMKL
C
C
C	DERDBZ:
C	======================================================
	Z=WW
	PHIF=((((((C6*Z + C7)*Z + C8)*Z+ C9)*Z + C10)*Z + C11)*Z + 1.00D+0
	-0)
	THETAF=(((((C1*Z + C2)*Z + C3)*Z + C4)*Z+ C5)*Z +1.00D+00)

	OKL=DSQRT(DETAB)
	PKL=DSQRT(1.00D+00/(PI*(ALK1+ALK2)))
	ANKL=OKL*PKL
	AMKL=2.00D+00*OVERLAP*ANKL

	DZZ=-2.00D+00*A3*ALK1**2.00D+00*ALK2*((A1*AZ+A2*BZ)/ALK1-(A3*CZ+A4
	-*DZ)/ALK2)/(DETAB*(ALK1+ALK2))

	DTHETAF=5.00D+00*C1*Z**4.00D+00*DZZ+4.00D+00*C2*Z**3.00D+00*DZZ+3.
	-00D+00*C3*Z**2.00D+00*DZZ+2.00D+00*C4*Z*DZZ+C5*DZZ

	DPHIF=6.00D+00*C6*Z**5.00D+00*DZZ+5.00D+00*C7*Z**4.00D+00*DZZ+4.00
	-D+00*C8*Z**3.00D+00*DZZ+3.00D+00*C9*Z**2.00D+00*DZZ+2.00D+00*C10*Z
     -*DZZ+C11*DZZ

	DF0=(DSQRT(PHIF)/(2.00D+00*DSQRT(THETAF)))*(-(THETAF/PHIF**2.00D+0
	-0)*DPHIF+(1.00D+00/PHIF)*DTHETAF)

	FF=DSQRT(THETAF/PHIF)

	DDETAB=0.00D+00
	DTEMP=0.00D+00

	DOKL=(1.00D+00/(2.00D+00*DSQRT(DETAB)))*DDETAB
	DPKL=(-1.00D+00/(2.00D+00*((PI*ALK2+PI*ALK1)*DSQRT((PI*ALK2+PI*ALK
	-1)))))*DTEMP
	
      DNKL=(OKL*DPKL + PKL*DOKL)

	DMKL=2.00D+00*(OVERLAP*DNKL + ANKL*DOVnDBZ)

	DERDBZ=AMKL*DF0 + FF*DMKL
C
	END IF
C	     
      RETURN                                                            
      END 
